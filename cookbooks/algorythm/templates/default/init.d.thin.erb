#!/bin/sh

RVM_INSTALLATION=/usr/local/rvm

# Exit if RVM is not installed
[ -d "$RVM_INSTALLATION" ] || exit 1

GEM_BIN_DIR=$($RVM_INSTALLATION/bin/rvm gemdir)/bin
THIN_BINARY="$GEM_BIN_DIR/thin"

# Exit if thin gem is not installed
[ -x "$THIN_BINARY" ] || exit 2

run_action() {
	su <%=@user%> -c 'export RAILS_ENV=production; PATH="$PATH"':/usr/local/rvm/wrappers/thin/:'"$GEM_BIN_DIR'; ruby '$THIN_BINARY' $1 --all /etc/thin"
}

case "$1" in
  start)
        run_action start
        ;;
  stop)
        run_action stop
        ;;
  restart|force-reload|reload)
        run_action restart
        ;;
  *)
        echo "Usage: service thin {start|stop|restart}" >&2
        exit 3
        ;;
esac


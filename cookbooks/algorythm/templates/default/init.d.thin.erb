#!/bin/sh

RVM_BINARY=/usr/local/rvm/bin/rvm

# Exit if RVM is not installed
[ -x "$RVM_BINARY" ] || exit 1

GEM_BIN_DIR=$($RVM_BINARY gemdir)/bin
THIN_BINARY="$GEM_BIN_DIR/thin"

# Exit if the package is not installed
[ -x "$THIN_BINARY" ] || exit 1

RUBY_BIN_DIR="/usr/local/rvm/rubies/default/bin"

run_action() {
	su -c "PATH=\"$PATH:/usr/local/rvm/bin:$RUBY_BIN_DIR:$GEM_BIN_DIR\"; ruby $THIN_BINARY $1 --all /etc/thin" <%=@user%>
}

case "$1" in
  start)
        run_action start
        ;;
  stop)
        run_action stop
        ;;
  restart|force-reload|reload)
        run_action restart
        ;;
  *)
        echo "Usage: service thin {start|stop|restart}" >&2
        exit 3
        ;;
esac


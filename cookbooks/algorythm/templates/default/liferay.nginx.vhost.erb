server {
	listen 80;
	server_name <%=@hostname%>;
	root /usr/share/nginx/www;

	access_log /var/log/nginx/liferay-proxy-access;
	error_log  /var/log/nginx/liferay-proxy-error;

	include proxy_params;
	set $cacheName $server_name'-http-cache'
	proxy_cache_path  $cacheRoot/$cacheName levels=1:2 keys_zone=$cacheName:8m max_size=1000m inactive=600m;
	proxy_temp_path   $cacheRoot/$cacheName/tmp;
	proxy_cache       $cacheName;
	proxy_cache_valid 302 96h;

	location / {
		proxy_pass http://127.0.0.1:<%=@http_port%>/;
	}
}

server {
	listen 443 ssl;
	server_name <%=@hostname%>;
	root /usr/share/nginx/www;

	access_log /var/log/nginx/liferay-proxy-access;
	error_log  /var/log/nginx/liferay-proxy-error;

	ssl_certificate     /etc/ssl/certs/ssl-cert-snakeoil.pem;
	ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;

	include proxy_params;
	set $cacheName $server_name'-https-cache'
	proxy_cache_path  $cacheRoot/$cacheName levels=1:2 keys_zone=$cacheName:8m max_size=1000m inactive=600m;
	proxy_temp_path   $cacheRoot/$cacheName/tmp;
	proxy_cache       $cacheName;
	proxy_cache_valid 302 96h;

	location / {
		proxy_pass http://127.0.0.1:<%=@https_port%>/;
	}
}
